{"version":3,"sources":["../src/drawer.js"],"names":["define","$","CustomEvents","Log","PubSub","SELECTORS","TOGGLE_REGION","TOGGLE_ACTION","TOGGLE_TARGET","TOGGLE_SIDE","BODY","SECTION","DRAWER","small","document","width","Drawer","length","debug","each","index","ele","trigger","find","drawerid","attr","drawer","getElementById","hidden","side","body","preference","on","preventPageScroll","addClass","bind","registerEventListeners","closeAll","prototype","removeClass","M","util","set_user_preference","toggleDrawer","e","target","closest","open","focus","publish","delta","wheelDelta","originalEvent","detail","bottomOverflow","scrollTop","outerHeight","scrollHeight","topOverflow","preventDefault","element","events","activate","data","click"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Contain the logic for a drawer.\r\n *\r\n * @package    theme_boostcgs\r\n * @copyright  2016 Damyon Wiese\r\n * @modified   2020 Michael Vangelovski\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(['jquery', 'core/custom_interaction_events', 'core/log', 'core/pubsub'],\r\n     function($, CustomEvents, Log, PubSub) {\r\n\r\n    var SELECTORS = {\r\n        TOGGLE_REGION: '[data-region=\"drawer-toggle\"]',\r\n        TOGGLE_ACTION: '[data-action=\"toggle-drawer\"]',\r\n        TOGGLE_TARGET: 'aria-controls',\r\n        TOGGLE_SIDE: 'left',\r\n        BODY: 'body',\r\n        SECTION: '.list-group-item[href*=\"#section-\"]',\r\n        DRAWER: '#nav-drawer'\r\n    };\r\n\r\n    var small = $(document).width() < 768;\r\n\r\n    /**\r\n     * Constructor for the Drawer.\r\n     *\r\n     * @param {object} root The root jQuery element for the modal\r\n     */\r\n    var Drawer = function() {\r\n\r\n        if (!$(SELECTORS.TOGGLE_REGION).length) {\r\n            Log.debug('Page is missing a drawer region');\r\n        }\r\n        if (!$(SELECTORS.TOGGLE_ACTION).length) {\r\n            Log.debug('Page is missing a drawer toggle link');\r\n        }\r\n        $(SELECTORS.TOGGLE_REGION).each(function(index, ele) {\r\n            var trigger = $(ele).find(SELECTORS.TOGGLE_ACTION);\r\n            var drawerid = trigger.attr('aria-controls');\r\n            var drawer = $(document.getElementById(drawerid));\r\n            var hidden = trigger.attr('aria-expanded') == 'false';\r\n            var side = trigger.attr('data-side');\r\n            var body = $(SELECTORS.BODY);\r\n            var preference = trigger.attr('data-preference');\r\n\r\n            drawer.on('mousewheel DOMMouseScroll', this.preventPageScroll);\r\n\r\n            if (!hidden) {\r\n                body.addClass('drawer-open-' + side);\r\n                trigger.attr('aria-expanded', 'true');\r\n            } else {\r\n                trigger.attr('aria-expanded', 'false');\r\n            }\r\n        }.bind(this));\r\n\r\n        this.registerEventListeners();\r\n        if (small) {\r\n            this.closeAll();\r\n        }\r\n    };\r\n\r\n    Drawer.prototype.closeAll = function() {\r\n        $(SELECTORS.TOGGLE_REGION).each(function(index, ele) {\r\n            var trigger = $(ele).find(SELECTORS.TOGGLE_ACTION);\r\n            var side = trigger.attr('data-side');\r\n            var body = $(SELECTORS.BODY);\r\n            var drawerid = trigger.attr('aria-controls');\r\n            var drawer = $(document.getElementById(drawerid));\r\n            var preference = trigger.attr('data-preference');\r\n\r\n            trigger.attr('aria-expanded', 'false');\r\n            body.removeClass('drawer-open-' + side);\r\n            drawer.attr('aria-hidden', 'true');\r\n            drawer.addClass('closed');\r\n            drawer.removeClass('open-mobile');\r\n            if (!small) {\r\n                M.util.set_user_preference(preference, 'false');\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Open / close the blocks drawer.\r\n     *\r\n     * @method toggleDrawer\r\n     * @param {Event} e\r\n     */\r\n    Drawer.prototype.toggleDrawer = function(e) {\r\n        var trigger = $(e.target).closest('[data-action=toggle-drawer]');\r\n        var drawerid = trigger.attr('aria-controls');\r\n        var drawer = $(document.getElementById(drawerid));\r\n        var body = $(SELECTORS.BODY);\r\n        var side = trigger.attr('data-side');\r\n        var preference = trigger.attr('data-preference');\r\n        body.addClass('drawer-ease');\r\n        var open = trigger.attr('aria-expanded') == 'true';\r\n        if (!open) {\r\n            // Open.\r\n            trigger.attr('aria-expanded', 'true');\r\n            drawer.attr('aria-hidden', 'false');\r\n            drawer.focus();\r\n            body.addClass('drawer-open-' + side);\r\n            drawer.removeClass('closed');\r\n            drawer.addClass('open-mobile');\r\n            if (!small) {\r\n                M.util.set_user_preference(preference, 'true');\r\n            }\r\n        } else {\r\n            // Close.\r\n            body.removeClass('drawer-open-' + side);\r\n            trigger.attr('aria-expanded', 'false');\r\n            drawer.attr('aria-hidden', 'true');\r\n            drawer.addClass('closed');\r\n            drawer.removeClass('open-mobile');\r\n            if (!small) {\r\n                M.util.set_user_preference(preference, 'false');\r\n            }\r\n        }\r\n\r\n        // Publish an event to tell everything that the drawer has been toggled.\r\n        // The drawer transitions closed so another event will fire once teh transition\r\n        // has completed.\r\n        PubSub.publish('nav-drawer-toggle-start', open);\r\n    };\r\n\r\n    /**\r\n     * Prevent the page from scrolling when the drawer is at max scroll.\r\n     *\r\n     * @method preventPageScroll\r\n     * @param  {Event} e\r\n     */\r\n    Drawer.prototype.preventPageScroll = function(e) {\r\n        var delta = e.wheelDelta || (e.originalEvent && e.originalEvent.wheelDelta) || -e.originalEvent.detail,\r\n            bottomOverflow = (this.scrollTop + $(this).outerHeight() - this.scrollHeight) >= 0,\r\n            topOverflow = this.scrollTop <= 0;\r\n\r\n        if ((delta < 0 && bottomOverflow) || (delta > 0 && topOverflow)) {\r\n            e.preventDefault();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set up all of the event handling for the modal.\r\n     *\r\n     * @method registerEventListeners\r\n     */\r\n    Drawer.prototype.registerEventListeners = function() {\r\n\r\n        $(SELECTORS.TOGGLE_ACTION).each(function(index, element) {\r\n            CustomEvents.define($(element), [CustomEvents.events.activate]);\r\n            $(element).on(CustomEvents.events.activate, function(e, data) {\r\n                this.toggleDrawer(data.originalEvent);\r\n                data.originalEvent.preventDefault();\r\n            }.bind(this));\r\n        }.bind(this));\r\n\r\n        $(SELECTORS.SECTION).click(function() {\r\n            if (small) {\r\n                this.closeAll();\r\n            }\r\n        }.bind(this));\r\n\r\n        // Publish an event to tell everything that the drawer completed the transition\r\n        // to either an open or closed state.\r\n        $(SELECTORS.DRAWER).on('webkitTransitionEnd msTransitionEnd transitionend', function(e) {\r\n            var drawer = $(e.target).closest(SELECTORS.DRAWER);\r\n            var open = drawer.attr('aria-hidden') == 'false';\r\n            PubSub.publish('nav-drawer-toggle-end', open);\r\n        });\r\n    };\r\n\r\n    return {\r\n        'init': function() {\r\n            return new Drawer();\r\n        }\r\n    };\r\n});"],"file":"drawer.min.js"}